# ruff: noqa: E402
import sys
from pathlib import Path

# Add backend directory to Python path for Django imports
backend_path = Path(__file__).parent / "backend"
sys.path.insert(0, str(backend_path))

# Set up Django before any Django imports
from utils.django_setup import setup_django_safe

setup_django_safe()

# All imports after Django setup
from fastapi import FastAPI
from strawberry.fastapi import GraphQLRouter

from gql.schema import schema

graphql_app = GraphQLRouter(schema)

app = FastAPI(title="TuneMeld GraphQL API")
app.include_router(graphql_app, prefix="/graphql")
app.include_router(graphql_app, prefix="/gql")


@app.get("/")
async def root():
    return {"message": "TuneMeld FastAPI GraphQL Server"}


@app.get("/health")
async def health():
    return {"status": "healthy"}
